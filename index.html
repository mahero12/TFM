<!DOCTYPE html>
<html>
<head>
    <title>Mapa de Riesgos de Accidentes en EE. UU</title>
    <!-- Importa las bibliotecas necesarias -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" />
    <style>
        /* Estilo para que el mapa ocupe toda la pantalla */
        html, body, #map { 
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- Crea un contenedor div para el mapa -->
    <div id="map"></div>

    <script src="clima_estados.js"></script> <!-- Agrega el archivo JavaScript con los datos climáticos -->

    <script>
        // Crea un nuevo mapa Leaflet
        var map = L.map('map').setView([39.5, -98.35], 4);

        // Agrega una capa de mapa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Crea un grupo de marcadores para agrupar los marcadores cercanos
        var markerCluster = L.markerClusterGroup();
        // Agrega el grupo de marcadores al mapa
        markerCluster.addTo(map);

        // Coordenadas y descripciones de los estados de EE.UU.
        var us_states_coords = {
            // Aquí van las coordenadas de cada estado...
        };
        
        // Función para mostrar información de clima
        function showWeather(state, month) {
            // Si el mes seleccionado es septiembre (segunda opción en el menú desplegable)
            if (month === 'septiembre') {
                // Obtener la información climática del estado seleccionado
                var clima_estado = clima_estados[state];
                // Crear el contenido HTML para la ventana emergente
                var html = `
                    <h4>${state}</h4>
                    <p>Temperatura: ${clima_estado['Temperatura']}</p>
                    <p>Viento: ${clima_estado['Viento']}</p>
                    <p>Precipitaciones: ${clima_estado['Precipitaciones']}</p>
                `;
                // Mostrar la ventana emergente con la información climática
                L.popup().setContent(html).setLatLng([us_states_coords[state]['lat'], us_states_coords[state]['lon']]).openOn(map);
            }
        }

        // Add a marker for each state
         for (var state in us_states_coords) {
            var loc = us_states_coords[state];
            var html = `
                <h4>${state}</h4>
                <p>${loc['desc']}</p>
                <label for='month_${state}'>Selecciona un mes:</label>
                <select id='month_${state}' name='month' onchange='showWeather("${state}", this.value)'>
                    <option value='agosto'>Agosto 2022</option>
                    <option value='septiembre'>Septiembre 2022</option>
                    <option value='octubre'>Octubre 2022</option>
                    <option value='noviembre'>Noviembre 2022</option>
                    <option value='diciembre'>Diciembre 2022</option>
                    <option value='enero'>Enero 2023</option>
                    <option value='febrero'>Febrero 2023</option>
                </select>
            `;
            var popup = L.popup().setContent(html);
            // Crea un marcador con la ubicación y la ventana emergente
            var marker = L.marker([loc['lat'], loc['lon']]).bindPopup(popup);
            // Agrega el marcador al grupo de marcadores
            markerCluster.addLayer(marker);
        }
    </script>
</body>
</html>
